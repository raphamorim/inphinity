var inphinity=function(){return this.loading=!1,this.debug=!1,this.currentPage=1,this.itemSelector="div.post",this.nextSelector="div.navigation a:first",this.navSelector="div.navigation",this.basePath="page2",this.path="page",this.dataType="html",this.bag=!1,this.bagClassName=!1,this.loader=!1,this.trustedRequest=!1,this.defaults={finishedMsg:"<em>That's all folks!</em>",loadingMsg:"Loading more...",animationSpeed:500},this.scroller=function(e){if(this.loading!==!0){var t=this.element.offsetTop+this.element.offsetHeight,i=t-e;750>=i&&(this.loading=!0,this.request())}},this.getPath=function(){var e=this.basePath;if(e.match(/^(.*?)\b2\b(.*?$)/))e=e.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(e.match(/^(.*?)2(.*?$)/)){if(e.match(/^(.*?page=)2(\/.*|$)/))return e=e.match(/^(.*?page=)2(\/.*|$)/).slice(1);e=e.match(/^(.*?)2(.*?$)/).slice(1)}else{if(e.match(/^(.*?page=)1(\/.*|$)/))return e=e.match(/^(.*?page=)1(\/.*|$)/).slice(1);this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL.")}return e},this.getUrlPath=function(){var e=document.querySelector(this.nextSelector).href.split("/");return e[e.length-1]},this.createBag=function(){var e=document.createElement("div");e.style.display="none",this.bagClassName=this.bagClassName||"ph-bag",e.className=this.bagClassName,this.element.appendChild(e),this.bag=document.querySelector("."+this.bagClassName)},this.createLoader=function(){var e=document.createElement("div");e.style.display="none",e.className="ph-loader",this.defaults.loadingMsg&&(e.innerHTML=this.defaults.loadingMsg),this.element.appendChild(e),this.loader=document.querySelector(".ph-loader")},this.updateLoader=function(){this.element.removeChild(this.loader),this.createLoader()},this.loaderToggle=function(e,t){this.loader.style.display="block",e===!0?this.animation().fadeIn(this.loader,t):e===!1&&this.animation().fadeOut(this.loader,t)},this.request=function(){var e=this,t=e.path+""+(e.currentPage+1),i=new XMLHttpRequest;e.loaderToggle(!0),i.open("GET",encodeURI(t)),i.onload=function(){if(200===i.status||e.trustedRequest){var t=/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(i.responseText).slice(1)[0];e.trustedRequest=!0,e.loaderToggle(!1,e.render.bind(e,t))}else e._debug("Request failed. Returned status of "+i.status)},i.send()},this.render=function(e,t){var i=this;i.bag.innerHTML=e;var n=i.bag.querySelectorAll(i.itemSelector);if(!n.length)return i.finished();if(1===i.currentPage&&t!==!0){var a=document.querySelector(i.navSelector);return i.animation().fadeOut(a,function(){return i.render(e,!0)})}for(var s=0;s<n.length;s++)i.element.appendChild(n[s]);i.toNext()},this.toNext=function(){this.updateLoader(),this.currentPage=this.currentPage+1,this.loading=!1},this.finished=function(){var e=document.createElement("div");e.className="ph-end",e.innerHTML=this.defaults.finishedMsg,this.element.appendChild(e)},this.on=function(e){return this.sel=e,this.element=document.querySelector(e),this},this.set=function(e){e.navSelector&&(this.navSelector=e.navSelector),e.nextSelector&&(this.nextSelector=e.nextSelector),e.itemSelector&&(this.itemSelector=e.itemSelector),e.loadingMsg&&(this.defaults.loadingMsg=e.loadingMsg),e.finishedMsg&&(this.defaults.finishedMsg=e.finishedMsg),e.animationSpeed&&(this.defaults.animationSpeed=e.animationSpeed,"slow"===e.animationSpeed&&(this.defaults.animationSpeed=800),"normal"===e.animationSpeed&&(this.defaults.animationSpeed=500),"fast"===e.animationSpeed&&(this.defaults.animationSpeed=300)),this.init()},this.init=function(){this.basePath=this.getUrlPath(),this.path=this.getPath()[0],this.createLoader(),this.createBag(),this.setEventScroll()},this.setEventScroll=function(){var e=this;window.addEventListener("scroll",function(t){e.scroller(t.target.activeElement.scrollTop)})},this._debug=function(e){console.log("Inphinity: ",e)},this.animation=function(){var e=this;return{fadeOut:function(t,i){t.style.opacity=1;var n=+new Date,a=function(){if(t.style.opacity=+t.style.opacity-(new Date-n)/e.defaults.animationSpeed,n=+new Date,+t.style.opacity>0)window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16);else{if(t.style.display="none","undefined"==typeof i)return!0;i()}};a()},fadeIn:function(t,i){t.style.opacity=0;var n=+new Date,a=function(){if(t.style.opacity=+t.style.opacity+(new Date-n)/e.defaults.animationSpeed,n=+new Date,+t.style.opacity<1)window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16);else{if("undefined"==typeof i)return!0;i()}};a()}}},{on:this.on.bind(this)}}();